<!DOCTYPE html>
<html lang="en"> <head><link rel="shortcut icon" href="/static/images/TechMonger%28CC%29.ico"><title>Solving Scrapy User timeout caused connection failure - Tech Monger</title><meta charset="UTF-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="description" content="If your scrapy spider is failing with error due to website request getting timed out then read this check list to solve issue."><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="canonical" href="/65/troubleshoot-scrapy-user-timeout/"><style>.lead{font-size:1.25rem;font-weight:300}</style></head> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-1476292113673713",
          enable_page_level_ads: true
     });
</script> <body> <div class="container"> <header class="container"> <h1 class="row"><a href="/">Tech Monger</a></h1> <p class="lead row">Programming, Web Development and Computer Science.</p> </header> <span id="skiplinks" class="skip-link"> <a href="#main" title="Main Content on Page">Skip to main content</a>| <a href="#sidebar" title="Sidebar of Blog">Skip to information by topic</a> </span> <div class="row"> <main class="col-lg-10" id="main"> <article class="container" itemscope itemtype="https://schema.org/BlogPosting"> <h2 itemprop="headline">How to Solve Scrapy's User Timeout Failure</h2> <p itemprop="datePublished" title="18-11-19 18:00:39Z">Posted November 19, 2018</p> <div itemprop="articleBody"> <p class="lead">If the website you are scraping is not responding to your requests then your spider would report failure due to request timeout and throw following error.</p> <pre class="bash">2018-11-19 12:06:25 [scrapy.downloadermiddlewares.retry] DEBUG:
Retrying <get https: example.com> (failed 1 times):
User timeout caused connection failure:
Getting https://example.com took longer than 180.0 seconds..
</pre> <hr> <p class="lead">By default spider will try requesting URL 3 times and give up the URL completely with the following error.</p> <pre class="bash">
twisted.internet.error.TimeoutError:
User timeout caused connection failure:
Getting https://example.com took longer than 180.0 seconds..
</pre> <hr> <h3 class="top2">Why Request is Getting Timed Out</h3> <p>There could be many potential reasons why server is not responding to the requested URL and the <b>exact reason</b> could only be figured by doing investigation on your own. Below are the most frequent causes for request getting timed out. </p> <ul> <li>Server has <b>rate limited</b> your IP Address.</li> <li>Server only responds to the IP Addresses of the the <b>specific region</b>.</li> <li>Server is too busy or under very <b>heavy load</b> for long period of time.</li> <li>Server responds to only specific <code>User-Agent</code>.</li> <li>Server responds only if <code>Cookies</code> are present inside request header.</li> <li><em>think more reasons on your own ....</em></li> </ul> <p> Above list will always remain incomplete and exact cause can only be figured out by doing trial and error on most probable cases. </p> <hr> <h3 class="top2">Get Request Details</h3> <h4>Browser</h4> <p> If server is responding to the requested URL inside the web browser with <b>same request IP address</b> then you should open <b>developer options</b> (inspect element) inside the web browser and check for the <strong>request headers</strong> inside <b>Network</b> tab. </p> <h4>cURL</h4> <p> In unix like operating system you can use tools like <code>CURL</code> to check request and response details inside <strong>verbose mode</strong>. </p> <pre class="bash"><code>curl -v 'https://example.com'
</code></pre> <hr> <h3 class="top2">Cross Verify Request Details with Scrapy</h3> <p> You can <em>now</em> use scrapy's <code>Request</code> object to <strong>compare</strong> requested details sent by <strong>scrapy vs Borwser (cURL)</strong> . <p> <p> You can check the requested headers by scrapy on some other URL of the <em>same site</em>. </p> <p> If no URL is working for the the site in question then you can check request details on some other site for which request is working i.e. server is responding with <b>same scrapy settings</b>. </p> <p> Scrapy stores request headers inside <code>request.headers</code> and request metadata inside <code>request.meta</code>.</p> <pre class="python"><code>>>> request.headers
{'Accept-Language': ['en'], 'Accept-Encoding': ['gzip,deflate'], 'Accept': ['text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'], 'User-Agent': ['Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/36.0.1985.67 Safari/537.36']}

>>> request.meta
{'handle_httpstatus_list': <scrapy.utils.datatypes.sequenceexclude object at 0x7f7d14ba6790>, 'download_timeout': 180.0, 'depth': 0, 'download_latency': 1.1379539966583252, 'download_slot': 'example.com'}
</code></pre> <p>Below are the objects available inside scrapy's request object.</p> <pre class="python"><code>>>> dir(request)
['__class__', '__delattr__', '__dict__', '__doc__', '__format__', 
'__getattribute__', '__hash__', '__init__', '__module__', '__new__', 
'__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__',
 '__slots__',  '__str__', '__subclasshook__', '__weakref__', '_body',
 '_encoding',  '_get_body', '_get_url', '_meta', '_set_body', '_set_url', '_url', 
'body',  'callback', 'cookies', 'copy', 'dont_filter', 'encoding', 
'errback',  'flags',  'headers', 'meta', 'method', 'priority', 'replace', 'url']
</code></pre> <hr> <h4 class="top2">Setting can be Deceptive</h4> <p>While debugging above error you may get trapped due to the way scrapy settings take precedence and this is especially true if you are using different middleware extensions like <a href="/62/example-scrapy-fake-user-agent/" title="Randomize rotating user agent for scrapy">Fake User Agent</a> . In scrapy you can set the setting at different levels and you must be aware about which configuration will take effect while you are investigating.</p> <h4 class="top2">Scrapy shell is your Friend</h4> <p> You should request the URL from scrapy shell from <strong>outside the scrapy project</strong> to avoid getting trapped with settings precedence. </p> <p> For example if server is responding only to the specific user agents then you can set user agent to test with scrapy shell like below. </p> <pre class="bash"><code>scrapy shell -s USER_AGENT='something-to-test' 'https://example.com'
</code></pre> <p>You can also set the custom headers and cookie within scrapy shell by modifying request object within shell. Below we have added custom headers before making request from scrapy shell. </p> <pre class="bash"><code>$ scrapy shell
</pre></code> <pre class="python"><code>from scrapy import Request

headers = {'Host': ['example.com'], 'Accept-Language': ['en'], 'Accept-Encoding': ['gzip,deflate'], 'Accept': ['text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'],, 'User-Agent': ['Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/537.36 (KHTML like Gecko) Chrome/44.0.2403.155 Safari/537.36']}

url = "https://example.com/"

request_object = Request(url, headers=headers)

fetch(request_object)

view(response)</pre></code> </code></pre> <hr> <h3 class="top3">Conclusion</h3> <div class="card"> <p class="card-body"> Request timout could be possible due to host of reasons. But to solve timeout issue you should try different request values while making request from scrapy shell and must take most frequent request timeout causes into the account. </p> </div> </div> <p class="top3">Tagged Under :<span itemprop="keywords"> <a href="/tag/python/">Python</a> <a href="/tag/scrapy/">Scrapy</a> <a href="/tag/web/">Web</a> </span> </p> </article> <div class="top3"> <div class="col-sm-9"> <span class="float-left"> <a class="btn btn-secondary btn-md" role="button" aria-disabled="false" href="/64/wtf-custom-validation-hack/" title="Integrate Custom Validation in WTForms using Flask">Previous</a> </span> <span class="float-right"> <a class="btn btn-secondary btn-md" role="button" aria-disabled="false" href="/66/standalone-tor-ubuntu/" title="Install TOR Systemwide On Debian Distros">Next</a> </span> </div> </div> </main> <aside class="col-lg-2 top5" id="sidebar"> <h3>Tags</h3> <nav> <ul> <li><a href="/tag/davmail/" title="Davmail Setup and Configuration">Davmail</a></li> <li><a href="/tag/flask/" title="Flask Web Development">Flask</a></li> <li><a href="/tag/google-cloud/" title="Google Cloud Tutorials and Examples">Google Cloud</a></li> <li><a href="/tag/informatica/" title="Informatica Administration Tutorials">Informatica</a></li> <li><a href="/tag/linux/" title="Linux Desktop and Server - Tutorials">Linux</a></li> <li><a href="/tag/localtunnel/" title="Localtunnel Tutorials -  HTTP Tunnel in Action">Localtunnel</a></li> <li><a href="/tag/open-source/" title="Tutorials about open source software ">Open Source</a></li> <li><a href="/tag/python/" title="Python Programming">Python</a></li> <li><a href="/tag/raspberry-pi/" title="Raspberry Pi Tutorials and Hacks">Raspberry Pi</a></li> <li><a href="/tag/thunderbird/" title="Thunderbird Tutorials">Thunderbird</a></li> <li><a href="/tag/ubuntu/" title="Ubuntu Tutorials">Ubuntu</a></li> <li><a href="/tag/web/" title="Tutorials for Full Stack Web Developers">Web</a></li> <li><a href="/tag/windows/" title="Windows Software and Tutorials">Windows</a></li> <li><a href="/tag/wordpress/" title="Wordpress Tutorials and Guides">Wordpress</a></li> </ul> </nav> <a href="/feeds/" title="Atom Feed - Tech Monger"><i class="fa fa-rss" aria-hidden="true"></i>&nbsp;&nbsp;Feeds</a> </aside> </div> <hr class="top3"> <footer class="top5 text-secondary"> <div class="container-fluid text-center text-md-left"> <div class="row"> <div class="col-md-6 mt-md-0 mt-3"> <h5 class="text-uppercase">About</h5> <p>Techmonger is a web log which shares interesting articles about computer science, programming and web development.</p> </div> <hr class="clearfix w-100 d-md-none pb-3"> <div class="col-md-3 mb-md-0 mb-3"> <h5 class="text-uppercase">Pages</h5> <ul class="list-unstyled"> <li> <a href="/privacy.html">Privacy Policy</a> </li> <li> <a href="/contact.html">Contact</a> </li> </ul> </div> </div> </div> </footer> <div class="top3"></div> <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css"> <script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script> <script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#ffffff"
    },
    "button": {
      "background": "#e0e0e0",
      "text": "#0a0202"
    }
  },
  "theme": "edgeless",
  "content": {
    "dismiss": "Accept",
    "href": "/privacy/"
  }
})});
</script> </div> <link rel="stylesheet" type="text/css" href="/static/css/style.css"> <script src="/static/js/scripts.js"></script> <script>hljs.initHighlightingOnLoad();</script> </body> </html>