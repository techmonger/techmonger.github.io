<!DOCTYPE html>
<html lang="en"> <head><link rel="shortcut icon" href="/static/images/TechMonger%28CC%29.ico"><title>Analysis - How Localtunnel Works in Practice - Tech Monger</title><meta charset="UTF-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="description" content="In this post we will analyze working of a localtunnel with tcpdump and learn how it works in practice."><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="canonical" href="/21/localtunnel-working/"><style>.lead{font-size:1.25rem;font-weight:300}</style></head> <body> <div class="container"> <header class="container"> <h1 class="row"><a href="/">Tech Monger</a></h1> <p class="lead row">Programming, Web Development and Computer Science.</p> </header> <span id="skiplinks" class="skip-link"> <a href="#main" title="Main Content on Page">Skip to main content</a>| <a href="#sidebar" title="Sidebar of Blog">Skip to information by topic</a> </span> <div class="row"> <main class="col-lg-9" id="main"> <article class="container" itemscope itemtype="https://schema.org/BlogPosting"> <h2 itemprop="headline">Analyzing Working of Localtunnel with TCPDUMP</h2> <p itemprop="datePublished" title="18-01-09 11:22:45Z">Posted January 09, 2018</p> <div itemprop="articleBody"> <p class="lead"> In the post we will learn more about working of localtunnel by analyzing request and response between localtunnel server and client using <code>tcpdump</code>. In earlier post we have learned about <a href="/20/httptunnel-working/" title="Localtunnel client server architecture">localtunnel architecture from theoretical perspective</a> however in this article we will take more hands on approach. If you want to follow along then you can <a href="/13/localtunnel-ubuntu/" title="Localtunnel Installation in Linux">install localtunnel</a> and <a href="/22/rpi-web-app/" title="Web App Deployment Behind NAT">host simple web application from your local computer</a>. This post is divided into setting up monitoring foundation and analyzing actual data. If you don't want to follow along with your own application then you can directly jump to <a href="#analysis">analysis</a> section. </p> <section id="foundation" class="top2"> <h3>Monitoring Foundation</h3> <h4 class="top3">Get IP Adress of Localtunnel Server</h4> <p>Before analyzing request and response we would need IP Address of localtunnel server. Since we are going to use default server at <code>localtunnel.me</code> we will fetch details with <code>nslookup</code> like below. </p> <pre><code class="bash">$ nslookup localtunnel.me

Non-authoritative answer:
Name:	localtunnel.me
Address: 138.197.63.247
</code></pre> <h4>Gather data with <code>tcpdump</code></h4> <p>Once we have above IP we can redirect request and response data between local computer and localtunnel server into the file.</p> <p> Note that once you start collecting data do not connect to <code>localtunnel.me</code> from browser or any other mean else you may get unnecessary noise into the data. You would need to <code>sudo</code> before running <code>tcpdump</code>. </p> <pre><code class="bash">$ sudo tcpdump | grep 138.197.63.247 >> lt_data.txt
</code></pre> <p>Above command would keep collecting data into the file <code>lt_data.txt</code>. Later we will monitor this file to analyze collected data. You can also use packet capturing tool like <code>wireshark</code> for this purpose </p> <h4>Register Application with Localtunnel Client</h4> <p>We have hosted small web application locally on port 5000. We will expose this app on localtunnel. </p> <pre><code class="bash">$ lt -p 5000
</code></pre> <p> Above command would give you random subdomain on which your application would be exposed. For advanced setup check all <a href="/14/localtunnel-example/" title="Localtunnel Commands">command line options of localtunnel client</a>. </p> <h4>Open Subdomain in Browser</h4> <p>To capture http request and response via tcpdump you can open registered subdomain on same computer or from different computer. </p> <div class="card"> <p class="card-body"> While you follow above steps tcpdump would gather required data into the file. Once you are done with above steps you can stop tcpdump and start analyzing collected data. </p> </div> </section> <section id="analysis" class="top3"> <h3>Analyzing Collected Data</h3> <h4 class="top2">Registering an Application</h4> <p> Client at <code>192.168.2.100</code> uses tcp port <code>36934</code> and sends http request to localtunnel server running at <code>138.197.63.247</code>. </p> <pre><code class="bash">IP 192.168.2.100.36934 > 138.197.63.247.http
</code></pre> <p>Server acknowledges client request.</p> <pre><code class="bash">IP 138.197.63.247.http > 192.168.2.100.36934
</code></pre> <p> Client sends one more <code>HTTP</code> request at localtunnel server to register application at path <code> /?new</code> which translates to <code>http://localtunnel.me/?new</code>. </p> <pre><code class="bash">IP 192.168.2.100.36934 > 138.197.63.247.http:GET /?new HTTP/1.1
</code></pre> <p> Server provides an internal port and subdomain on which it has registered client application in <code>JSON</code> format. Server provides details in HTTP body. (Internal Port returned : <code>34223</code>) </p> <pre><code class="bash">IP 138.197.63.247.http > 192.168.2.100.36934: HTTP: HTTP/1.1 200 OK
</code></pre> <h4 class="top2">10 Active TCP Connections</h4> <p>Client opens 10 tcp connections on the internal port <code>34223</code> of server. Client keep listening on these connections to serve http requests from users.</p> <pre><code class="bash">IP 192.168.2.100.37112 > 138.197.63.247.34223
IP 192.168.2.100.37114 > 138.197.63.247.34223
IP 192.168.2.100.37116 > 138.197.63.247.34223
IP 192.168.2.100.37118 > 138.197.63.247.34223
IP 192.168.2.100.37120 > 138.197.63.247.34223
IP 192.168.2.100.37122 > 138.197.63.247.34223
IP 192.168.2.100.37124 > 138.197.63.247.34223
IP 192.168.2.100.37126 > 138.197.63.247.34223
IP 192.168.2.100.37128 > 138.197.63.247.34223
IP 192.168.2.100.37130 > 138.197.63.247.34223
</code></pre> <h4 class="top2">HTTP Requests and Response</h4> <p>User opens application subdomain in browser which results in <code>https</code> request to localtunnel server.</p> <pre><code class="bash">IP 192.168.2.101.51760 > 138.197.63.247.https
</code></pre> <p>Server replay user request and sends it to client (local computer) using one of the active client tcp connection. </p> <pre><code class="bash">IP 138.197.63.247.34223 > 192.168.2.100.37116
</code></pre> <p>Local computer processes request from server and sends the response.</p> <pre><code class="bash">IP 192.168.2.100.37116 > 138.197.63.247.34223
</code></pre> <p>Server relay back response to user.</p> <pre><code class="bash">IP 138.197.63.247.https >192.168.2.101.51760
</code></pre> </section> <section> <h3>Conclusion</h3> <div class="card"> <p class="card-body"> Localtunnel server act as a proxy between user and local computer on which actual application is hosted. It uses active client tcp connections to relay requests and responses. Note that If any of the active tcp connection gets dropped then client again opens new tcp connection and always keep 10 active connections with server. </p> </div> </section> </div> <p class="top3">Tagged Under :<span itemprop="keywords"> <a href="/tag/linux/">Linux</a> <a href="/tag/localtunnel/">Localtunnel</a> <a href="/tag/open-source/">Open Source</a> <a href="/tag/ubuntu/">Ubuntu</a> <a href="/tag/web/">Web</a> </span> </p> </article> <div class="top3"> <div class="col-sm-9"> <span class="float-left"> <a class="btn btn-secondary btn-md" role="button" aria-disabled="false" href="/20/httptunnel-working/" title="Inner Working of HTTP Tunnels - Localtunnel">Previous</a> </span> <span class="float-right"> <a class="btn btn-secondary btn-md" role="button" aria-disabled="false" href="/22/rpi-web-app/" title="How to Deploy Web Application from Home">Next</a> </span> </div> </div> </main> <aside class="col-lg-3 top5" id="sidebar"> <div class="text-right"> <h3>Tags</h3> <nav> <ul> <li class="list-unstyled"><a href="/tag/davmail/" title="Davmail Setup and Configuration">Davmail</a></li> <li class="list-unstyled"><a href="/tag/flask/" title="Flask Web Development">Flask</a></li> <li class="list-unstyled"><a href="/tag/google-cloud/" title="Google Cloud Tutorials and Examples">Google Cloud</a></li> <li class="list-unstyled"><a href="/tag/informatica/" title="Informatica Administration Tutorials">Informatica</a></li> <li class="list-unstyled"><a href="/tag/linux/" title="Linux Desktop and Server - Tutorials">Linux</a></li> <li class="list-unstyled"><a href="/tag/localtunnel/" title="Localtunnel Tutorials -  HTTP Tunnel in Action">Localtunnel</a></li> <li class="list-unstyled"><a href="/tag/open-source/" title="Tutorials about open source software ">Open Source</a></li> <li class="list-unstyled"><a href="/tag/python/" title="Python Programming">Python</a></li> <li class="list-unstyled"><a href="/tag/raspberry-pi/" title="Raspberry Pi Tutorials and Hacks">Raspberry Pi</a></li> <li class="list-unstyled"><a href="/tag/thunderbird/" title="Thunderbird Tutorials">Thunderbird</a></li> <li class="list-unstyled"><a href="/tag/ubuntu/" title="Ubuntu Tutorials">Ubuntu</a></li> <li class="list-unstyled"><a href="/tag/web/" title="Tutorials for Full Stack Web Developers">Web</a></li> <li class="list-unstyled"><a href="/tag/windows/" title="Windows Software and Tutorials">Windows</a></li> <li class="list-unstyled"><a href="/tag/wordpress/" title="Wordpress Tutorials and Guides">Wordpress</a></li> </ul> </nav> </div> <div class="top2 float-left"> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-1476292113673713" data-ad-slot="8720400182"></ins> <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
        </script> <div> <div class="text-center"> <a class="top3" href="/feeds/" title="Atom Feed - Tech Monger"><i class="fa fa-rss" aria-hidden="true"></i>&nbsp;&nbsp;Feeds</a> </div> </aside> </div> <hr class="top3"> <footer class="top5 text-secondary"> <div class="container-fluid text-center text-md-left"> <div class="row"> <div class="col-md-4 mt-md-0 mt-3"> <h5 class="text-uppercase">About</h5> <p>Techmonger is a web log which shares interesting articles about computer science, programming and web development.</p> </div> <hr class="clearfix w-100 d-md-none pb-3"> <div class="col-md-3 mb-md-0 mb-3"> <h5 class="text-uppercase">Pages</h5> <ul class="list-unstyled"> <li> <a href="/privacy.html">Privacy Policy</a> </li> <li> <a href="/contact.html">Contact</a> </li> </ul> </div> <div class="col-md-5 mb-md-0 mb-3"> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:inline-block;width:468px;height:60px" data-ad-client="ca-pub-1476292113673713" data-ad-slot="1929762560"></ins> <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
            </script> </div> </div> </div> </footer> <div class="top3"></div> <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css"> <script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script> <script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#ffffff"
    },
    "button": {
      "background": "#e0e0e0",
      "text": "#0a0202"
    }
  },
  "theme": "edgeless",
  "content": {
    "dismiss": "Accept",
    "href": "/privacy.html"
  }
})});
</script> </div> <link rel="stylesheet" type="text/css" href="/static/css/style.css"> <script src="/static/js/scripts.js"></script> <script>hljs.initHighlightingOnLoad();</script> </body> </html>