<!DOCTYPE html>
<html lang="en"> <head><link rel="shortcut icon" href="/static/images/TechMonger%28CC%29.ico"><title>Apache Configuration - Lets Encrypt SSL Certficates - Tech Monger</title><meta charset="UTF-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="description" content="If you have SSL letsencrypt certficates installed via certbot then you can track changes made to your configuration files."><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="canonical" href="/50/certbot-apache-configuration/"><style>.lead{font-size:1.25rem;font-weight:300}</style></head> <body> <div class="container"> <header class="container"> <h1 class="row"><a href="/">Tech Monger</a></h1> <p class="lead row">Programming, Web Development and Computer Science.</p> </header> <span id="skiplinks" class="skip-link"> <a href="#main" title="Main Content on Page">Skip to main content</a>| <a href="#sidebar" title="Sidebar of Blog">Skip to information by topic</a> </span> <div class="row"> <main class="col-lg-9" id="main"> <article class="container" itemscope itemtype="https://schema.org/BlogPosting"> <a href="/50/certbot-apache-configuration/"> <h2 itemprop="headline">How Certbot Modify Apache Configuration Files </h2> </a> <p itemprop="datePublished" title="18-08-24 16:49:09Z">Posted August 24, 2018</p> <div itemprop="articleBody"> <p class="lead"> If you have <a href="/48/free-ssl-wordpress/" title="Lets Encrypt - Free HTTPS Certificate For Website">installed letsencrypt ssl certficate via cerbot client</a> on apache webserver then certbot program must have made configuration changes on your apache webserver. It is worth noting those changes in order to debug apache later on. We have installed certficates on debian running apache and below are the configuration changes made by certbot. </p> <hr> <h3>Lets Encrypt Certificate File Location</h3> <p>When you install SSL certificates from Letsencrypt on Linux, files get stored at following location. </p> <table class="table text-center"> <tr> <th>File</th> <th>Location</th> </tr> <tr> <td>Certificate File</td> <td>/etc/letsencrypt/live/www.example.com/fullchain.pem</td> </tr> <tr> <td>Private Key File</td> <td>/etc/letsencrypt/live/www.example.com/privkey.pem</td> </tr> </table> <hr> <h4 id="ssl" class="top3">Let's Encrypt Apache SSL Configuration File</h4> <p class="top2">Certbot will create letsencrypt specific ssl configuration file <code>000-default-le-ssl.conf</code> for the Apache webserver inside <code>/etc/apache2/sites-available</code>. For the most part it will inherit configuration from file <code>default-ssl.conf</code> in same directory. It will append following details related to ssl certificate. </p> <p>If you are using fedora based distro like red hat then you shall see similar apache configuration files inside <code>/etc/httpd/conf/</code>.</p> <pre class="bash" class="top1"><code>ServerName www.example.com
SSLCertificateFile /etc/letsencrypt/live/www.example.com/fullchain.pem
SSLCertificateKeyFile /etc/letsencrypt/live/www.example.com/privkey.pem
Include /etc/letsencrypt/options-ssl-apache.conf
</code></pre> <p>Note that how last line includes SSL configuration for apache from let's encrypt's configuration directory <code>options-ssl-apache.conf</code>. <hr> <h4 id="redirect" class="top3">Letsencrypt Redirect Configuration</h4> <p class="top2">If you have opted for <code>HTTP</code> to <code>HTTPS</code> redirect during certificate installation then certbot will modify file <code>000-default.conf</code> inside <code>/etc/apache2/sites-available</code> and create redirect rule like below.</p> <pre class="bash" class="top1"><code>RewriteEngine on
RewriteCond %{SERVER_NAME} =www.example.com
RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]
</code></pre> <hr> <h4 id="www" class="top3">WWW Redirect to HTTPS Website</h4> <p class="top2"> It is very common practise to redirect <strong>non www</strong> traffic to <strong>www</strong> version of the website. If you want to configure <code>non www</code> to <code>www</code> redirect for your site then you will have to do it <strong>manually</strong> by modifying configuration file like below. </p> <p class="card-body alert alert-warning"> It is highly advised to backup configuration files before making any modification so that configuration can be restored if needed. </p> <h5 class="top3">Redirect Non WWW Traffic to WWW</h5> <p class="top2"> Redirect <code>non www</code> traffic to <code>www</code> coming over <code>HTTP</code> by adding following rule inside <code>/etc/apache2/sites-available/000-default.conf</code> <b>below existing rule</b>. </p> <pre class="bash" class="top1"><code>RewriteEngine on
RewriteCond %{SERVER_NAME} =example.com
RewriteRule ^ https://www.%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]</code></pre> <p class="top2"> It will redirect all non www traffic to www version of the website over http and <code>www</code> version of the website will in turn redirect it to secure version of the www website. This will avoid <em>ssl security exception</em> error in browser. </p> <h5 class="top3">Redirect Non WWW HTTPS Traffic to HTTPS WWW</h5> <p class="top2"> Redirect <code>non www HTTPS</code> traffic to <code>www HTTPS</code> by adding following rule inside <code>/etc/apache2/sites-available/000-default.conf</code> <b>before closing <code>VirtualHost</code> tag.</b>. </p> <pre class="bash" class="top1"><code>ServerName www.example.com
SSLCertificateFile /etc/letsencrypt/live/www.example.com/fullchain.pem
SSLCertificateKeyFile /etc/letsencrypt/live/www.example.com/privkey.pem
Include /etc/letsencrypt/options-ssl-apache.conf

RewriteEngine on
RewriteCond %{SERVER_NAME} =example.com
RewriteRule ^ https://www.%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]
</code></pre> <hr> <h4 class="top3">Conclusion</h4> <div class="card"> <p class="card-body"> We have seen how certbot make modification to existing apache configuration files to add letsencrypt ssl details. We have also seen redirect configuration rules added by certbot and how to manually add additional rules to redirect www traffic to secure non www version of the website. </p> </div> </div> <p class="top3">Tagged Under :<span itemprop="keywords"> <a href="/tag/certbot/">Certbot</a> <a href="/tag/google-cloud/">Google Cloud</a> <a href="/tag/lets-encrypt/">Lets Encrypt</a> <a href="/tag/linux/">Linux</a> <a href="/tag/web/">Web</a> </span> </p> </article> <div class="top3"> <div class="col-sm-9"> <span class="float-left"> <a class="btn btn-secondary btn-md" role="button" aria-disabled="false" href="/49/certbot-auto-renew/" title="Certbot SSL Certification Auto Renew Cron Job">Previous</a> </span> <span class="float-right"> <a class="btn btn-secondary btn-md" role="button" aria-disabled="false" href="/51/informatica-infacmd-connection/" title="Secure infamd connection using encrypted password">Next</a> </span> </div> </div> </main> <aside class="col-lg-3 top5" id="sidebar"> <div class="text-right"> <h3>Tags</h3> <nav> <ul> <li class="list-unstyled"><a href="/tag/davmail/" title="Davmail Setup and Configuration">Davmail</a></li> <li class="list-unstyled"><a href="/tag/flask/" title="Flask Web Development">Flask</a></li> <li class="list-unstyled"><a href="/tag/google-cloud/" title="Google Cloud Tutorials and Examples">Google Cloud</a></li> <li class="list-unstyled"><a href="/tag/informatica/" title="Informatica Administration Tutorials">Informatica</a></li> <li class="list-unstyled"><a href="/tag/linux/" title="Linux Desktop and Server - Tutorials">Linux</a></li> <li class="list-unstyled"><a href="/tag/localtunnel/" title="Localtunnel Tutorials -  HTTP Tunnel in Action">Localtunnel</a></li> <li class="list-unstyled"><a href="/tag/open-source/" title="Tutorials about open source software ">Open Source</a></li> <li class="list-unstyled"><a href="/tag/python/" title="Python Programming">Python</a></li> <li class="list-unstyled"><a href="/tag/raspberry-pi/" title="Raspberry Pi Tutorials and Hacks">Raspberry Pi</a></li> <li class="list-unstyled"><a href="/tag/thunderbird/" title="Thunderbird Tutorials">Thunderbird</a></li> <li class="list-unstyled"><a href="/tag/ubuntu/" title="Ubuntu Tutorials">Ubuntu</a></li> <li class="list-unstyled"><a href="/tag/web/" title="Tutorials for Full Stack Web Developers">Web</a></li> <li class="list-unstyled"><a href="/tag/windows/" title="Windows Software and Tutorials">Windows</a></li> <li class="list-unstyled"><a href="/tag/wordpress/" title="Wordpress Tutorials and Guides">Wordpress</a></li> </ul> </nav> </div> <div class="top2 float-left"> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-1476292113673713" data-ad-slot="8720400182"></ins> <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
        </script> <div> <div class="text-center"> <a class="top3" href="/feeds/" title="Atom Feed - Tech Monger"><i class="fa fa-rss" aria-hidden="true"></i>&nbsp;&nbsp;Feeds</a> </div> </aside> </div> <hr class="top3"> <footer class="top5 text-secondary"> <div class="container-fluid text-center text-md-left"> <div class="row"> <div class="col-md-6 mt-md-0 mt-3"> <h5 class="text-uppercase">About</h5> <p>Techmonger is a web log which shares interesting articles about computer science, programming and web development.</p> </div> <hr class="clearfix w-100 d-md-none pb-3"> <div class="col-md-3 mb-md-0 mb-3"> <h5 class="text-uppercase">Pages</h5> <ul class="list-unstyled"> <li> <a href="/privacy.html">Privacy Policy</a> </li> <li> <a href="/contact.html">Contact</a> </li> </ul> </div> <div class="col-md-3 mb-md-0 mb-3"> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:inline-block;width:468px;height:60px" data-ad-client="ca-pub-1476292113673713" data-ad-slot="1929762560"></ins> <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
            </script> </div> </div> </div> </footer> <div class="top3"></div> <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css"> <script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script> <script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#ffffff"
    },
    "button": {
      "background": "#e0e0e0",
      "text": "#0a0202"
    }
  },
  "theme": "edgeless",
  "content": {
    "dismiss": "Accept",
    "href": "/privacy.html"
  }
})});
</script> </div> <link rel="stylesheet" type="text/css" href="/static/css/style.css"> <script src="/static/js/scripts.js"></script> <script>hljs.initHighlightingOnLoad();</script> </body> </html>